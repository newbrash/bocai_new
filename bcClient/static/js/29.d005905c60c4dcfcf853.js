webpackJsonp([29],{dyQO:function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("mvHQ"),n=e.n(i);console.log("USER_PAGEFRIEND_FRIEND_VUE");var a={data:function(){return{friendsShow:!0,strangeShow:!1,systemShow:!1,host:this.GLOBAL.Host,iconDown:"icon-jiantouxia",iconUp:"icon-jiantoushang",friendLength:0,friendOnline:0,strangeLength:0,strangeOnline:0,systemLength:0,noticeNum:0,requestNum:0,msgList:this.GLOBAL.friendMsgNum}},watch:{systemShow:function(){this.systemShow&&this.changeSystemReadStatus()}},mounted:function(){console.log("friend->mounted...");var s=this;this.checkLogin(),this.onmessage(function(){console.log("firend->message->callback..."),s.calculateNumber()}),this.calculateNumber(),this.systemShow&&this.changeSystemReadStatus(),this.$parent.tabbarShow=!0,this.$parent.tabbarWhic=!1,localStorage.setItem("bc_friendInfo",null),this.GLOBAL.friendInfo={}},updated:function(){console.log("friend->updated..."),this.systemShow&&(this.requestNum||this.noticeNum)&&this.changeSystemReadStatus()},methods:{goto:function(s,t,e,i){var a=this;if(2==e){if(!t.stmessage)return this.$messagebox.confirm("对方设置了拒收陌生人消息，是否删除？").then(function(s){a.delStrange(t,i)}).catch(function(s){}),!1;if(!this.GLOBAL.userInfo.stmessage)return this.$messagebox.confirm("你设置了拒收陌生人消息，对方无法向你发送消息，是否现在是修改设置？").then(function(s){a.$router.push("/mySystem")}).catch(function(s){}),!1}var o={info:t,status:e};console.log("(((((((((((((((((saveFriendInfo))))))))))))))))))"),this.setGlobalAttribute(this.GLOBAL.friendInfo,o),console.log(this.GLOBAL.friendInfo),localStorage.setItem("bc_friendInfo",n()(this.GLOBAL.friendInfo)),console.log(n()(o)),console.log(localStorage.getItem("bc_friendInfo")),console.log("(((((((((((((((((saveFriendInfo))))))))))))))))))"),this.$router.push(s)},delMessage:function(s,t){console.log("<deletevalue>"),console.log(s),console.log("</deletevalue>");var e={send_id:this.GLOBAL.userInfo.id,msg_id:s.mid,type:"DeleteMessage",con_id:this.GLOBAL.connectionId},i=this;this.senddata({data:e,callback:function(s){console.log(s),i.GLOBAL.friendLists.system[t]=null,i.systemLength--},handType:"user"})},calculateNumber:function(){for(var s in console.log("friend->methods->calculateNumber..."),this.friendLength=0,this.friendOnline=0,this.strangeLength=0,this.strangeOnline=0,this.systemLength=0,this.requestNum=0,this.noticeNum=0,this.GLOBAL.friendLists)for(var t in this.GLOBAL.friendLists[s])this.GLOBAL.friendLists[s][t]&&("friends"==s?(this.GLOBAL.friendLists[s][t].on_status&&(this.friendOnline+=1),this.friendLength+=1):"strange"==s?(this.GLOBAL.friendLists[s][t].on_status&&(this.strangeOnline+=1),this.strangeLength+=1):(this.GLOBAL.friendLists[s][t].flag||(3==this.GLOBAL.friendLists[s][t]?this.requestNum+=1:this.noticeNum+=1),this.systemLength+=1))},friendSlide:function(){this.friendsShow=!this.friendsShow},strangerSlide:function(){this.strangeShow=!this.strangeShow},systemSlide:function(){this.systemShow=!this.systemShow},friendDel:function(s){var t=this;this.$messagebox.confirm("确定要删除好友"+s.nickname+"吗？").then(function(e){var i={type:"deleteFriend",send_id:t.GLOBAL.userInfo.id,nickname:t.GLOBAL.userInfo.nickname,friend_id:s.id,con_id:t.GLOBAL.connectionId,fcon_id:s.connectionID},n=t;t.senddata({data:i,callback:function(t){t.result?(n.$messagebox.alert(s.nickname+"已经从好友列表中除移"),n.GLOBAL.friendLists.friends[s.id].on_status&&n.friendOnline--,n.friendLength--,n.GLOBAL.friendLists.friends[s.id]=null,n.GLOBAL.msgLength-=n.GLOBAL.friendMsgNum[s.id],n.GLOBAL.friendMsgNum[s.id]=null,n.GLOBAL.msgList[s.id]=null,n.$forceUpdate()):n.$messagebox.alert("删除失败！")},handType:"user"})})},agreen:function(s,t,e){var i={type:"AgreeFriendRequest",send_id:this.GLOBAL.userInfo.id,nickname:this.GLOBAL.userInfo.nickname,username:this.GLOBAL.userInfo.username,head:this.GLOBAL.userInfo.head,friend_id:s.id,msg_id:s.mid,msg_status:t,con_id:this.GLOBAL.connectionId,fcon_id:s.connectionID},n=this;this.senddata({data:i,callback:function(e){if(console.log("<RESPONE>"),console.log(e),console.log("</RESPONE>"),e.result){if(console.log(t),6==t){n.GLOBAL.msgLength++,n.GLOBAL.friendMsgNum[s.id]?n.GLOBAL.friendMsgNum[s.id]++:n.$set(n.GLOBAL.friendMsgNum,s.id,1);var i={};if(n.GLOBAL.msgList[s.id]){var a=n.GLOBAL.msgList[s.id],o=0;for(var c in a)a[c]&&(i[o]=a[c],o++);i[o]=e.msg}else i[0]=e.msg;n.$set(n.GLOBAL.msgList,s.id,{}),n.setGlobalAttribute(n.GLOBAL.msgList[s.id],i);var d={id:s.id,head:s.head,on_status:s.status,nickname:s.nickname,medals:s.medals,username:s.username,connectionID:s.connectionID};n.$set(n.GLOBAL.friendLists.friends,s.id,{}),n.setGlobalAttribute(n.GLOBAL.friendLists.friends[s.id],d),n.GLOBAL.friendLists.strange[s.id]&&(n.GLOBAL.friendLists.strange[s.id].on_status&&n.strangeOnline--,n.strangeLength--,n.GLOBAL.friendLists.strange[s.id]=null)}s.status=t,n.$forceUpdate()}else n.$messagebox.alert("网络堵塞，请稍后再试！")},handType:"user"})},changeSystemReadStatus:function(){if(this.noticeNum||this.requestNum){var s={type:"changeSystemReadStatus",send_id:this.GLOBAL.userInfo.id,con_id:this.GLOBAL.connectionId},t=this;this.senddata({data:s,callback:function(s){if(console.log("<changeStatus>"),console.log(s),console.log("</changeStatus>"),s.status){for(var e in t.GLOBAL.msgLength=t.GLOBAL.msgLength-t.noticeNum-t.requestNum,t.noticeNum=0,t.requestNum=0,t.GLOBAL.friendLists.system)t.GLOBAL.friendLists.system[e].flag=1;t.$forceUpdate()}},handType:"user"})}},delStrange:function(s,t){var e={send_id:this.GLOBAL.userInfo.id,get_id:s.id,type:"delStrange",con_id:this.GLOBAL.connectionId},i=this;this.senddata({data:e,callback:function(t){t.status?(i.GLOBAL.msgLength-=i.GLOBAL.friendMsgNum[s.id],i.GLOBAL.friendLists.strange[s.id].on_status&&i.strangeOnline--,i.GLOBAL.friendMsgNum[s.id]=null,i.GLOBAL.friendLists.strange[s.id]=null,i.GLOBAL.msgList[s.id]=null,i.strangeLength--,i.$forceUpdate()):i.$messagebox.alert("网络堵塞，请稍后再试！")},handType:"user"})}}},o={render:function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticStyle:{background:"#e7e7e7","min-height":"100vh",margin:"0px","padding-bottom":"15vw"}},[e("mt-header",{staticStyle:{height:"10vw",background:"#57D6DD"},attrs:{title:"我的好友",fixed:"true"}},[e("router-link",{attrs:{slot:"left",to:"/user"},slot:"left"},[e("mt-button",{attrs:{icon:"back"}},[s._v("返回")])],1),s._v(" "),e("router-link",{attrs:{slot:"right",to:"/addFriend"},slot:"right"},[e("mt-button",[e("i",{staticClass:"iconfont icon-tianjiahaoyou",staticStyle:{"font-size":"20px"}})])],1)],1),s._v(" "),e("div",{staticClass:"module"},[e("div",{staticClass:"f-title",staticStyle:{"margin-top":"10vw"},on:{click:s.friendSlide}},[s._v("全部好友 ("+s._s(s.friendOnline)+"/"+s._s(s.friendLength)+")\n      "),e("i",{staticClass:"iconfont",class:s.friendsShow?s.iconDown:s.iconUp})]),s._v(" "),s._l(this.GLOBAL.friendLists.friends,function(t,i){return e("div",{directives:[{name:"show",rawName:"v-show",value:s.friendsShow,expression:"friendsShow"}],key:i},["online"!=i&&t?e("div",{staticClass:"f-list"},[e("div",{staticClass:"f-info",on:{click:function(e){s.goto("/chat",t,1,i)}}},[e("div",{staticClass:"f-info"},[e("div",{staticClass:"f-pic"},[e("img",{attrs:{src:s.host+t.head}}),s._v(" "),e("mt-badge",{directives:[{name:"show",rawName:"v-show",value:s.msgList[t.id],expression:"msgList[value.id]"}],staticClass:"badge friend-badge",attrs:{type:"error",size:"small"}},[s._v(s._s(s.msgList[t.id]))])],1),s._v(" "),e("div",{staticClass:"f-main"},[e("div",{staticClass:"f-username"},[s._v(s._s(t.nickname)+"\n                "),t.on_status?e("span",[s._v("[在线]")]):e("span",[s._v("[离线]")])]),s._v(" "),e("span",{staticClass:"f-medaltitle"},[s._v("勋章：")]),s._v(" "),e("div",{staticClass:"f-medal"},s._l(t.medals,function(t,i){return e("div",{key:i,staticClass:"one-medal"},[e("img",{attrs:{src:s.host+t}})])}))])])]),s._v(" "),e("div",{staticClass:"f-btn"},[e("button",{staticClass:"del",on:{click:function(e){s.friendDel(t)}}},[s._v("删除好友")])])]):s._e()])})],2),s._v(" "),e("div",{staticClass:"module"},[e("div",{staticClass:"f-title",on:{click:s.strangerSlide}},[s._v("陌生人("+s._s(s.strangeOnline)+"/"+s._s(s.strangeLength)+")\n      "),e("i",{staticClass:"iconfont",class:s.strangeShow?s.iconDown:s.iconUp})]),s._v(" "),s._l(this.GLOBAL.friendLists.strange,function(t,i){return e("div",{directives:[{name:"show",rawName:"v-show",value:s.strangeShow,expression:"strangeShow"}],key:i},["online"!=i&&t?e("div",{staticClass:"f-list"},[e("div",{staticClass:"f-info",on:{click:function(e){s.goto("/chat",t,2,i)}}},[e("div",{staticClass:"f-info"},[e("div",{staticClass:"f-pic"},[e("img",{attrs:{src:s.host+t.head}}),s._v(" "),e("mt-badge",{directives:[{name:"show",rawName:"v-show",value:s.msgList[t.id],expression:"msgList[value.id]"}],staticClass:"badge friend-badge",attrs:{type:"error",size:"small"}},[s._v(s._s(s.msgList[t.id]))])],1),s._v(" "),e("div",{staticClass:"f-main"},[e("div",{staticClass:"f-username"},[s._v(s._s(t.nickname)+"\n                "),t.on_status?e("span",[s._v("[在线]")]):e("span",[s._v("[离线]")])]),s._v(" "),e("span",{staticClass:"f-medaltitle"},[s._v("勋章：")]),s._v(" "),e("div",{staticClass:"f-medal"},s._l(t.medals,function(t,i){return e("div",{key:i,staticClass:"one-medal"},[e("img",{attrs:{src:s.host+t}})])}))])])]),s._v(" "),e("div",{staticClass:"f-btn"},[e("button",{staticClass:"del",on:{click:function(e){s.delStrange(t,i)}}},[s._v("删除")])])]):s._e()])})],2),s._v(" "),e("div",{staticClass:"module"},[e("div",{staticClass:"f-title",on:{click:s.systemSlide}},[s._v("系统消息("+s._s(s.systemLength)+")\n      "),e("i",{staticClass:"iconfont",class:s.systemShow?s.iconDown:s.iconUp})]),s._v(" "),s._l(this.GLOBAL.friendLists.system,function(t,i){return e("div",{directives:[{name:"show",rawName:"v-show",value:s.systemShow,expression:"systemShow"}],key:i},[t?e("div",{staticClass:"f-list"},[e("div",{staticClass:"f-info"},[e("div",{staticClass:"f-pic"},[e("img",{attrs:{src:s.host+t.head}})]),s._v(" "),e("div",{staticClass:"f-main"},[e("div",{staticClass:"f-username"},[s._v(s._s(t.nickname)+"\n              "),t.on_status?e("span",[s._v("[在线]")]):e("span",[s._v("[离线]")])]),s._v(" "),5==t.status?e("div",{staticClass:"f-medal",staticStyle:{width:"60vw","font-size":"3vw"}},[s._v("\n              "+s._s(t.content)+"\n            ")]):e("div",{staticClass:"f-medal",staticStyle:{"font-size":"3vw"}},[s._v("\n              "+s._s(t.content)+"\n            ")])])]),s._v(" "),3==t.status?e("div",{staticClass:"f-btn"},[e("button",{staticClass:"accept",on:{click:function(e){s.agreen(t,6,i)}}},[s._v("接受")]),s._v(" "),e("button",{staticClass:"del",on:{click:function(e){s.agreen(t,4,i)}}},[s._v("拒绝")])]):4==t.status?e("div",{staticClass:"f-btn"},[e("button",{staticClass:"accept"},[s._v("已拒绝")]),s._v(" "),e("button",{staticClass:"del",on:{click:function(e){s.delMessage(t,i)}}},[s._v("删除")])]):6==t.status?e("div",{staticClass:"f-btn"},[e("button",{staticClass:"accept"},[s._v("已通过")]),s._v(" "),e("button",{staticClass:"del",on:{click:function(e){s.delMessage(t,i)}}},[s._v("删除")])]):e("div",{staticClass:"f-btn",staticStyle:{}},[e("button",{staticClass:"del",on:{click:function(e){s.delMessage(t,i)}}},[s._v("删除")])])]):s._e()])})],2)],1)},staticRenderFns:[]};var c=e("VU/8")(a,o,!1,function(s){e("hVLc")},"data-v-70edcec1",null);t.default=c.exports},hVLc:function(s,t){}});
//# sourceMappingURL=29.d005905c60c4dcfcf853.js.map